C51 COMPILER V9.54   CLAC                                                                  08/12/2015 15:10:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE CLAC
OBJECT MODULE PLACED IN .\Objects\clac.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE clac.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\clac.lst) TABS(2) OBJECT(.\Objects\clac.obj)

line level    source

   1          #include "reg51.h"
   2          #include "intrins.h"
   3          #define Display   P0
   4          #define Matrix    P1
   5          sbit Z = P2^2;
   6          sbit Y = P2^3;
   7          sbit X = P2^4;
   8          
   9          unsigned char code list[10] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f};    //ÔÚÊýÂë¹ÜÉ
             -Ï0~9¶ÔÓ¦µÄHex
  10          unsigned char Record[8];
  11          long int  FirstNum, SecNum = 0, result = 0;               //ÔÚKeil£¬longÕ¼4¸ö×Ö½Ú£¬·¶Î§ -2147483648~+2147483647 
  12          unsigned char KeyValue = 0;                               //¼ÇÂ¼°´¼üÐòºÅ
  13          unsigned char i = 0;                                      //¼ÇÂ¼ÒÑ¾­ÊäÈëÁË¶àÉÙ¸öÊý×Ö
  14          unsigned char Law;                                        //¼ÇÂ¼ÔËËã·¨Ôò
  15          void Delay10ms();                                         //ÑÓÊ±10ms
  16          void Delay20ms();                                         //ÑÓÊ±20ms
  17          void KeyScan();                                           //É¨Ãè¾ØÕó°´¼üÒÔ¶¨Î»£¬È·¶¨ÊäÈëµÄÊýÖµ
  18          void Show();                                              //ÔÚ¶¯Ì¬ÊýÂë¹ÜÉÏÏÔÊ¾ÐÅÏ¢
  19          long int Constr();
  20          void Deconstr();
  21          void Trans();
  22          void Init();                        //Initialization£¬³õÊ¼»¯
  23          
  24          void main(void)
  25          {
  26   1        Init();
  27   1        while (1)
  28   1        {
  29   2          Matrix = 0x0f;
  30   2          if (Matrix != 0x0f)
  31   2          {
  32   3            KeyScan();
  33   3            Trans();
  34   3            switch (KeyValue)
  35   3            {
  36   4              case 0:
  37   4              case 1:
  38   4              case 2:
  39   4              case 3:
  40   4              case 4:
  41   4              case 5:
  42   4              case 6:
  43   4              case 7:
  44   4              case 8:
  45   4              case 9:
  46   4              {
  47   5                unsigned char j;
  48   5                i++;
  49   5                if (i == 1)
  50   5                  Record[0] = KeyValue;
  51   5                else
  52   5                  for (j = i ; j > 0; j--)
  53   5                    Record[j] = Record[j - 1];
C51 COMPILER V9.54   CLAC                                                                  08/12/2015 15:10:52 PAGE 2   

  54   5                Record[0] = KeyValue;
  55   5                KeyValue = 16;
  56   5                Show();
  57   5                break;
  58   5              }
  59   4              case 'c': 
  60   4              {
  61   5              Init();
  62   5              break;
  63   5              }
  64   4              case 'a': 
  65   4              {
  66   5                FirstNum = Constr();
  67   5                Law = 'a';
  68   5                Init();
  69   5                break;
  70   5              }
  71   4              case 'm':
  72   4              {
  73   5                FirstNum = Constr();
  74   5                Law = 'm';
  75   5                Init();
  76   5                break;
  77   5              }
  78   4              case 'M':
  79   4              {
  80   5                FirstNum = Constr();
  81   5                Law = 'M';
  82   5                Init();
  83   5                break;
  84   5              }
  85   4              case 'd':
  86   4              {
  87   5                FirstNum = Constr();
  88   5                Law = 'd';
  89   5                Init();
  90   5                break;
  91   5              }
  92   4              case 'e':
  93   4              {
  94   5                if (FirstNum == 0)
  95   5                  _nop_();
  96   5                else 
  97   5                {
  98   6                  SecNum = Constr();
  99   6                  switch (Law)
 100   6                  {
 101   7                    case 'a': result = FirstNum + SecNum; break;
 102   7                    case 'm': result = FirstNum - SecNum; break;                                  
 103   7                    case 'M': result = FirstNum * SecNum; break;
 104   7                    case 'd': result = FirstNum / SecNum; break;                              //Ä¿Ç°¿´À´£¬³ý·¨ÔËËã²¢²»Í
             -êÉÆ£º1.±äÁ¿Ê¹ÓÃ long int¡£2.ÉÐÎ´½â¾öÐ¡ÊýµãµÄÎÊÌâ
 105   7                  }
 106   6                  Deconstr();
 107   6                  i = 7;
 108   6                  for (i = 0; Record[i] != 0; i++);
 109   6                  Show();
 110   6                }
 111   5              }
 112   4            }
 113   3          }
 114   2          Show();
C51 COMPILER V9.54   CLAC                                                                  08/12/2015 15:10:52 PAGE 3   

 115   2        }
 116   1      }
 117          
 118          /*------------------------ÑÓÊ±º¯Êý-----------------------------*/
 119          void Delay10ms()    //@11.0592MHz
 120          {
 121   1        unsigned char i, j;
 122   1      
 123   1        i = 108;
 124   1        j = 145;
 125   1        do
 126   1        {
 127   2          while (--j);
 128   2        } while (--i);
 129   1      }
 130          
 131          void Delay20ms()    //@11.0592MHz
 132          {
 133   1        unsigned char i, j, k;
 134   1      
 135   1        _nop_();
 136   1        _nop_();
 137   1        i = 1;
 138   1        j = 216;
 139   1        k = 35;
 140   1        do
 141   1        {
 142   2          do
 143   2          {
 144   3            while (--k);
 145   3          } while (--j);
 146   2        } while (--i);
 147   1      }
 148          /*-------------------------É¨Ãè¾ØÕó¼üÅÌ------------------------*/
 149          void KeyScan()
 150          {
 151   1        if (Matrix != 0x0f)
 152   1          Delay10ms();
 153   1        {
 154   2          if (Matrix != 0x0f)
 155   2          {
 156   3      //      Matrix = 0x0f;
 157   3            KeyValue = 0;
 158   3            switch (Matrix)
 159   3              {
 160   4                case 0x07:
 161   4                  KeyValue = 1; break;
 162   4                case 0x0b:
 163   4                  KeyValue = 2; break;
 164   4                case 0x0d:
 165   4                  KeyValue = 3; break;
 166   4                case 0x0e:
 167   4                  KeyValue = 4; break;
 168   4              }
 169   3            Matrix = 0xf0;
 170   3            switch (Matrix)
 171   3            {
 172   4              case 0xe0:
 173   4                break;
 174   4              case 0xd0:
 175   4                KeyValue = KeyValue + 1 * 4; break;
 176   4              case 0xb0:
C51 COMPILER V9.54   CLAC                                                                  08/12/2015 15:10:52 PAGE 4   

 177   4                KeyValue = KeyValue + 2 * 4; break;
 178   4              case 0x70:
 179   4                KeyValue = KeyValue + 3 * 4; break;
 180   4            }
 181   3          }
 182   2        }
 183   1        Delay20ms();
 184   1      }
 185          /*-----------------¸ù¾Ý°´¼üÐòºÅ¶¨Òå°´¼üµÄ¹¦ÄÜ---------------------*/
 186          void Trans()
 187          {
 188   1        switch (KeyValue)
 189   1        {
 190   2          case 1: KeyValue = 'c'; break; //ÇåÁã£¬clean
 191   2          case 2: KeyValue = 1; break;
 192   2          case 3: KeyValue = 4; break;
 193   2          case 4: KeyValue = 7; break;
 194   2          case 5: KeyValue = 0; break;
 195   2          case 6: KeyValue = 2; break;
 196   2          case 7: KeyValue = 5; break;
 197   2          case 8: KeyValue = 8; break;
 198   2          case 9: KeyValue = 'e'; break; //µÈÓÚ£¬equal
 199   2          case 10: KeyValue = 3; break;
 200   2          case 11: KeyValue = 6; break;
 201   2          case 12: KeyValue = 9; break;
 202   2          case 13: KeyValue = 'a'; break; //¼Ó£¬add
 203   2          case 14: KeyValue = 'm'; break; //¼õ£¬minus
 204   2          case 15: KeyValue = 'M'; break; //³Ë£¬Multiplication
 205   2          case 16: KeyValue = 'd'; break; //³ýÒÔ£¬Division
 206   2        }
 207   1      }
 208          /*--------------------ÔÚ¶¯Ì¬ÊýÂë¹ÜÉÏÏÔÊ¾ÐÅÏ¢---------------------*/
 209          void Show()
 210          {
 211   1        int j, x; 
 212   1        for (j = 0; j < i; j++)
 213   1        {
 214   2          switch(j)
 215   2          {
 216   3            case 0:
 217   3              X = 1; Y = 1; Z = 1; break;
 218   3            case 1:
 219   3              X = 1, Y = 1; Z = 0; break;
 220   3            case 2:
 221   3              X = 1; Y = 0; Z = 1; break;
 222   3            case 3:
 223   3              X = 1; Y = 0; Z = 0; break;
 224   3            case 4:
 225   3              X = 0; Y = 1; Z = 1; break;
 226   3            case 5:
 227   3              X = 0, Y = 1; Z = 0; break;
 228   3            case 6:
 229   3              X = 0; Y = 0; Z = 1; break;
 230   3            case 7:
 231   3              X = 0; Y = 0; Z = 0; break;
 232   3          }
 233   2          Display = list[Record[j]];
 234   2          x = 10;
 235   2          while (x--);
 236   2          Display = 0x00;
 237   2        }
 238   1      }
C51 COMPILER V9.54   CLAC                                                                  08/12/2015 15:10:52 PAGE 5   

 239          /*-----------------------ºÏ³ÉÊµ¼ÊÊäÈëµÄÊýÖµ------------------------*/
 240          long int Constr()
 241          {
 242   1        unsigned char a, b;
 243   1        long int Temp;
 244   1        for (a = 0, b = 1, Temp = 0; a <= 7; a++)
 245   1        {
 246   2          Temp = Temp + Record[a] * b;
 247   2          b *= 10;
 248   2        }
 249   1        return Temp;
 250   1      }
 251          /*-----------------------½â¹¹ÔËËã½á¹ûµ½¼ÆËãÆ÷µÄ¸÷¸öÊýÂë¹ÜÉÏ---------*/
 252          void Deconstr()
 253          {
 254   1        unsigned char a;
 255   1        for (a = 0; a<= 7; a++)
 256   1        {
 257   2          Record[a] = result % 10;
 258   2          result = (result - Record[a]) / 10;
 259   2        }
 260   1      }
 261          
 262          void Init()
 263          {
 264   1        X = 1; Y = 1; Z = 1;
 265   1        Display = 0x3f;
 266   1        for (i = 0; i <= 7; i++)
 267   1          Record[i] = 0;
 268   1        i = 0;
 269   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    915    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
